"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.OpusDecoder = void 0;
const DuplexStream_1 = require("./DuplexStream");
const OPUS_HEAD = Buffer.from('OpusHead');
const OPUS_TAGS = Buffer.from('OpusTags');
class OpusDecoder extends DuplexStream_1.OpusDuplexStream {
    constructor(options) {
        super(options);
    }
    _write(chunk, _, done) {
        if (chunk.compare(OPUS_HEAD, 0, 8, 0, 8) === 0) {
            this.opusHead = chunk;
            this.emit('opusHead', chunk);
        }
        else if (chunk.compare(OPUS_TAGS, 0, 8, 0, 8) === 0) {
            this.opusTags = chunk;
            this.emit('opusTags', chunk);
        }
        else {
            let frame;
            try {
                frame = this.encoder.decode(chunk);
            }
            catch (err) {
                done(err);
                return;
            }
            this.push(frame);
        }
        done();
    }
    applyCTL(ctl, value) {
        this.encoder.decode_ctl(ctl, value);
    }
}
exports.OpusDecoder = OpusDecoder;
//# sourceMappingURL=OpusDecoder.js.map