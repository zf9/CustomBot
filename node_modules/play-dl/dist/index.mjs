var st=Object.defineProperty;var a=(t,e)=>st(t,"name",{value:e,configurable:!0});import{Readable as ve}from"node:stream";import{request as ht}from"node:https";import{URL as dt}from"node:url";import{createGunzip as pt,createBrotliDecompress as mt,createDeflate as ft}from"node:zlib";import{existsSync as nt,readFileSync as ot,writeFileSync as at}from"node:fs";var g;nt(".data/youtube.data")&&(g=JSON.parse(ot(".data/youtube.data","utf-8")),g.file=!0);function ye(){let t="";if(!!g?.cookie){for(let[e,i]of Object.entries(g.cookie))t+=`${e}=${i};`;return t}}a(ye,"getCookies");function lt(t,e){return g?.cookie?(t=t.trim(),e=e.trim(),Object.assign(g.cookie,{[t]:e}),!0):!1}a(lt,"setCookie");function ut(){g.cookie&&g.file&&at(".data/youtube.data",JSON.stringify(g,void 0,4))}a(ut,"uploadCookie");function be(t){let e=t.cookie,i={};e.split(";").forEach(r=>{let s=r.split("=");if(s.length<=1)return;let n=s.shift()?.trim(),o=s.join("=").trim();Object.assign(i,{[n]:o})}),g={cookie:i},g.file=!1}a(be,"setCookieToken");function ge(t){!g?.cookie||(t.forEach(e=>{e.split(";").forEach(i=>{let r=i.split("=");if(r.length<=1)return;let s=r.shift()?.trim(),n=r.join("=").trim();lt(s,n)})}),ut())}a(ge,"cookieHeaders");var te=["Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.93 Safari/537.36 Edg/96.0.1054.43","Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like Gecko","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.93 Safari/537.36","Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.93 Safari/537.36","Mozilla/5.0 (Windows NT 10.0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.93 Safari/537.36","Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:94.0) Gecko/20100101 Firefox/94.0","Mozilla/5.0 (Windows NT 6.3) AppleWebKit/537.36.0 (KHTML, like Gecko) Chrome/61.0.0.0 Safari/537.36.0","Mozilla/5.0 (Windows; U; Windows NT 6.1) AppleWebKit/531.35.5 (KHTML, like Gecko) Version/4.0.3 Safari/531.35.5","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/42.0.2311.135 Safari/537.36 Edge/12.246","Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:15.0) Gecko/20100101 Firefox/15.0.1"];function _e(t){te.push(...t)}a(_e,"setUserAgent");function ct(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t+1))+t}a(ct,"getRandomInt");function we(){let t=ct(0,te.length-1);return te[t]}a(we,"getRandomUserAgent");function D(t,e={method:"GET"}){return new Promise(async(i,r)=>{let s=await re(t,e).catch(n=>n);if(s instanceof Error){r(s);return}Number(s.statusCode)>=300&&Number(s.statusCode)<400&&(s=await D(s.headers.location,e)),i(s)})}a(D,"request_stream");function ke(t,e={method:"GET"}){return new Promise(async(i,r)=>{let s=await re(t,e).catch(n=>n);if(s instanceof Error){r(s);return}if(Number(s.statusCode)>=300&&Number(s.statusCode)<400)s=await ke(s.headers.location,e);else if(Number(s.statusCode)>400){r(new Error(`Got ${s.statusCode} from the request`));return}i(s)})}a(ke,"internalRequest");function u(t,e={method:"GET"}){return new Promise(async(i,r)=>{let s=!1;if(e.cookies){let c=ye();typeof c=="string"&&e.headers&&(Object.assign(e.headers,{cookie:c}),s=!0)}e.headers&&(e.headers={...e.headers,"accept-encoding":"gzip, deflate, br","user-agent":we()});let n=await ke(t,e).catch(c=>c);if(n instanceof Error){r(n);return}n.headers&&n.headers["set-cookie"]&&s&&ge(n.headers["set-cookie"]);let o=[],l,d=n.headers["content-encoding"];d==="gzip"?l=pt():d==="br"?l=mt():d==="deflate"&&(l=ft()),l?(n.pipe(l),l.setEncoding("utf-8"),l.on("data",c=>o.push(c)),l.on("end",()=>i(o.join("")))):(n.setEncoding("utf-8"),n.on("data",c=>o.push(c)),n.on("end",()=>i(o.join(""))))})}a(u,"request");function ie(t){return new Promise(async(e,i)=>{let r=await re(t,{method:"HEAD"}).catch(n=>n);if(r instanceof Error){i(r);return}let s=Number(r.statusCode);if(s<300)e(t);else if(s<400){let n=await ie(r.headers.location).catch(o=>o);if(r instanceof Error){i(r);return}e(n)}else i(new Error(`${r.statusCode}: ${r.statusMessage}, ${t}`))})}a(ie,"request_resolve_redirect");function re(t,e={}){return new Promise((i,r)=>{let s=new dt(t);e.method??="GET";let n={host:s.hostname,path:s.pathname+s.search,headers:e.headers??{},method:e.method},o=ht(n,i);o.on("error",l=>{r(l)}),e.method==="POST"&&o.write(e.body),o.end()})}a(re,"https_getter");var F=class{constructor(e,i,r){this.stream=new ve({highWaterMark:5*1e3*1e3,read(){}}),this.type=_.Arbitrary,this.url=e,this.base_url="",this.segments_urls=[],this.packet_count=0,this.request=null,this.video_url=r,this.interval=i||0,this.timer=new $(()=>{this.start()},this.interval),this.dash_timer=new $(()=>{this.dash_timer.reuse(),this.dash_updater()},1800),this.stream.on("close",()=>{this.cleanup()}),this.start()}async dash_updater(){let e=await C(this.video_url);e.LiveStreamData.isLive===!0&&e.LiveStreamData.hlsManifestUrl!==null&&e.video_details.durationInSec===0&&(this.url=e.LiveStreamData.dashManifestUrl)}async dash_getter(){let i=(await u(this.url)).split('<AdaptationSet id="0"')[1].split("</AdaptationSet>")[0].split("</Representation>");i[i.length-1]===""&&i.pop(),this.base_url=i[i.length-1].split("<BaseURL>")[1].split("</BaseURL>")[0];let r=i[i.length-1].split("<SegmentList>")[1].split("</SegmentList>")[0];this.segments_urls=r.replace(new RegExp('<SegmentURL media="',"g"),"").split('"/>'),this.segments_urls[this.segments_urls.length-1]===""&&this.segments_urls.pop()}cleanup(){this.timer.destroy(),this.dash_timer.destroy(),this.request?.destroy(),this.video_url="",this.request=null,this.url="",this.base_url="",this.segments_urls=[],this.packet_count=0,this.interval=0}async start(){if(this.stream.destroyed){this.cleanup();return}await this.dash_getter(),this.segments_urls.length>3&&this.segments_urls.splice(0,this.segments_urls.length-3),this.packet_count===0&&(this.packet_count=Number(this.segments_urls[0].split("sq/")[1].split("/")[0]));for await(let e of this.segments_urls)Number(e.split("sq/")[1].split("/")[0])===this.packet_count&&await new Promise(async(i,r)=>{let s=await D(this.base_url+e).catch(n=>n);if(s instanceof Error){this.stream.emit("error",s);return}this.request=s,s.on("data",n=>{this.stream.push(n)}),s.on("end",()=>{this.packet_count++,i("")}),s.once("error",n=>{this.stream.emit("error",n)})});this.timer.reuse()}pause(){}resume(){}};a(F,"LiveStream");var G=class{constructor(e,i,r,s,n,o){this.stream=new ve({highWaterMark:5*1e3*1e3,read(){}}),this.url=e,this.quality=o.quality,this.type=i,this.bytes_count=0,this.video_url=n,this.per_sec_bytes=Math.ceil(s/r),this.content_length=s,this.request=null,this.timer=new $(()=>{this.timer.reuse(),this.loop()},265),this.stream.on("close",()=>{this.timer.destroy(),this.cleanup()}),this.loop()}async retry(){let e=await C(this.video_url),i=J(e.format);this.url=i[this.quality].url}cleanup(){this.request?.destroy(),this.request=null,this.url=""}async loop(){if(this.stream.destroyed){this.timer.destroy(),this.cleanup();return}let e=this.bytes_count+this.per_sec_bytes*300,i=await D(this.url,{headers:{range:`bytes=${this.bytes_count}-${e>=this.content_length?"":e}`}}).catch(r=>r);if(i instanceof Error){this.stream.emit("error",i),this.bytes_count=0,this.per_sec_bytes=0,this.cleanup();return}if(Number(i.statusCode)>=400){this.cleanup(),await this.retry(),this.timer.reuse(),this.loop();return}this.request=i,i.on("data",r=>{this.stream.push(r)}),i.once("error",async()=>{this.cleanup(),await this.retry(),this.timer.reuse(),this.loop()}),i.on("data",r=>{this.bytes_count+=r.length}),i.on("end",()=>{e>=this.content_length&&(this.timer.destroy(),this.stream.push(null),this.cleanup())})}pause(){this.timer.pause()}resume(){this.timer.resume()}};a(G,"Stream");var $=class{constructor(e,i){this.callback=e,this.time_total=i,this.time_left=i,this.paused=!1,this.destroyed=!1,this.time_start=process.hrtime()[0],this.timer=setTimeout(this.callback,this.time_total*1e3)}pause(){return!this.paused&&!this.destroyed?(this.paused=!0,clearTimeout(this.timer),this.time_left=this.time_left-(process.hrtime()[0]-this.time_start),!0):!1}resume(){return this.paused&&!this.destroyed?(this.paused=!1,this.time_start=process.hrtime()[0],this.timer=setTimeout(this.callback,this.time_left*1e3),!0):!1}reuse(){return this.destroyed?!1:(clearTimeout(this.timer),this.time_left=this.time_total,this.paused=!1,this.time_start=process.hrtime()[0],this.timer=setTimeout(this.callback,this.time_total*1e3),!0)}destroy(){clearTimeout(this.timer),this.destroyed=!0,this.callback=()=>{},this.time_total=0,this.time_left=0,this.paused=!1,this.time_start=0}};a($,"Timer");import{URL as yt,URLSearchParams as bt}from"node:url";var j="[a-zA-Z_\\$][a-zA-Z_0-9]*",gt="'[^'\\\\]*(:?\\\\[\\s\\S][^'\\\\]*)*'",_t='"[^"\\\\]*(:?\\\\[\\s\\S][^"\\\\]*)*"',Se=`(?:${gt}|${_t})`,R=`(?:${j}|${Se})`,wt=`(?:\\.${j}|\\[${Se}\\])`,Te=`(?:''|"")`,xe=":function\\(a\\)\\{(?:return )?a\\.reverse\\(\\)\\}",Ee=":function\\(a,b\\)\\{return a\\.slice\\(b\\)\\}",Ie=":function\\(a,b\\)\\{a\\.splice\\(0,b\\)\\}",De=":function\\(a,b\\)\\{var c=a\\[0\\];a\\[0\\]=a\\[b(?:%a\\.length)?\\];a\\[b(?:%a\\.length)?\\]=c(?:;return a)?\\}",kt=new RegExp(`var (${j})=\\{((?:(?:${R}${xe}|${R}${Ee}|${R}${Ie}|${R}${De}),?\\r?\\n?)+)\\};`),vt=new RegExp(`${`function(?: ${j})?\\(a\\)\\{a=a\\.split\\(${Te}\\);\\s*((?:(?:a=)?${j}`}${wt}\\(a,\\d+\\);)+)return a\\.join\\(${Te}\\)\\}`),St=new RegExp(`(?:^|,)(${R})${xe}`,"m"),Tt=new RegExp(`(?:^|,)(${R})${Ee}`,"m"),xt=new RegExp(`(?:^|,)(${R})${Ie}`,"m"),Et=new RegExp(`(?:^|,)(${R})${De}`,"m");function It(t){let e=vt.exec(t),i=kt.exec(t);if(!e||!i)return null;let r=i[1].replace(/\$/g,"\\$"),s=i[2].replace(/\$/g,"\\$"),n=e[1].replace(/\$/g,"\\$"),o=St.exec(s),l=o&&o[1].replace(/\$/g,"\\$").replace(/\$|^'|^"|'$|"$/g,"");o=Tt.exec(s);let d=o&&o[1].replace(/\$/g,"\\$").replace(/\$|^'|^"|'$|"$/g,"");o=xt.exec(s);let c=o&&o[1].replace(/\$/g,"\\$").replace(/\$|^'|^"|'$|"$/g,"");o=Et.exec(s);let k=o&&o[1].replace(/\$/g,"\\$").replace(/\$|^'|^"|'$|"$/g,""),p=`(${[l,d,c,k].join("|")})`,b=`(?:a=)?${r}(?:\\.${p}|\\['${p}'\\]|\\["${p}"\\])\\(a,(\\d+)\\)`,O=new RegExp(b,"g"),I=[];for(;(o=O.exec(n))!==null;)switch(o[1]||o[2]||o[3]){case k:I.push(`sw${o[4]}`);break;case l:I.push("rv");break;case d:I.push(`sl${o[4]}`);break;case c:I.push(`sp${o[4]}`);break}return I}a(It,"js_tokens");function Dt(t,e){let i=e.split(""),r=t.length;for(let s=0;s<r;s++){let n=t[s],o;switch(n.slice(0,2)){case"sw":o=parseInt(n.slice(2)),$t(i,o);break;case"rv":i.reverse();break;case"sl":o=parseInt(n.slice(2)),i=i.slice(o);break;case"sp":o=parseInt(n.slice(2)),i.splice(0,o);break}}return i.join("")}a(Dt,"deciper_signature");function $t(t,e){let i=t[0];t[0]=t[e],t[e]=i}a($t,"swappositions");function Ot(t,e){if(!t.url)return;let i=decodeURIComponent(t.url),r=new yt(i);r.searchParams.set("ratebypass","yes"),e&&r.searchParams.set(t.sp||"signature",e),t.url=r.toString()}a(Ot,"download_url");async function $e(t,e){let i=await u(e),r=It(i);return t.forEach(s=>{let n=s.signatureCipher||s.cipher;if(n){let o=Object.fromEntries(new bt(n));Object.assign(s,o),delete s.signatureCipher,delete s.cipher}if(r&&s.s){let o=Dt(r,s.s);Ot(s,o),delete s.s,delete s.sp}}),t}a($e,"format_decipher");var v=class{constructor(e={}){if(!e)throw new Error(`Cannot instantiate the ${this.constructor.name} class without data!`);this.type="channel",this.name=e.name||null,this.verified=!!e.verified||!1,this.artist=!!e.artist||!1,this.id=e.id||null,this.url=e.url||null,this.icons=e.icons||[{url:null,width:0,height:0}],this.subscribers=e.subscribers||null}iconURL(e={size:0}){if(typeof e.size!="number"||e.size<0)throw new Error("invalid icon size");if(!this.icons?.[0]?.url)return;let i=this.icons?.[0]?.url.split("=s")[1].split("-c")[0];return this.icons?.[0]?.url.replace(`=s${i}-c`,`=s${e.size}-c`)}toString(){return this.name||""}toJSON(){return{name:this.name,verified:this.verified,artist:this.artist,id:this.id,url:this.url,icons:this.icons,type:this.type,subscribers:this.subscribers}}};a(v,"YouTubeChannel");var L=class{constructor(e){this.url=e.url,this.width=e.width,this.height=e.height}toJSON(){return{url:this.url,width:this.width,height:this.height}}};a(L,"YouTubeThumbnail");var S=class{constructor(e){if(!e)throw new Error(`Can not initiate ${this.constructor.name} without data`);this.id=e.id||void 0,this.url=`https://www.youtube.com/watch?v=${this.id}`,this.type="video",this.title=e.title||void 0,this.description=e.description||void 0,this.durationRaw=e.duration_raw||"0:00",this.durationInSec=(e.duration<0?0:e.duration)||0,this.uploadedAt=e.uploadedAt||void 0,this.views=parseInt(e.views)||0;let i=[];for(let r of e.thumbnails)i.push(new L(r));this.thumbnails=i||[],this.channel=new v(e.channel)||{},this.likes=e.likes||0,this.live=!!e.live,this.private=!!e.private,this.tags=e.tags||[]}toString(){return this.url||""}toJSON(){return{id:this.id,url:this.url,title:this.title,description:this.description,durationInSec:this.durationInSec,durationRaw:this.durationRaw,uploadedAt:this.uploadedAt,thumbnail:this.thumbnails[this.thumbnails.length-1].toJSON()||this.thumbnails,channel:this.channel,views:this.views,tags:this.tags,likes:this.likes,live:this.live,private:this.private}}};a(S,"YouTubeVideo");var Ct="https://www.youtube.com/youtubei/v1/browse?key=",x=class{constructor(e,i=!1){this._continuation={};if(!e)throw new Error(`Cannot instantiate the ${this.constructor.name} class without data!`);this.__count=0,this.fetched_videos=new Map,this.type="playlist",i?this.__patchSearch(e):this.__patch(e)}__patch(e){this.id=e.id||void 0,this.url=e.url||void 0,this.title=e.title||void 0,this.videoCount=e.videoCount||0,this.lastUpdate=e.lastUpdate||void 0,this.views=e.views||0,this.link=e.link||void 0,this.channel=new v(e.channel)||void 0,this.thumbnail=e.thumbnail?new L(e.thumbnail):void 0,this.videos=e.videos||[],this.__count++,this.fetched_videos.set(`${this.__count}`,this.videos),this._continuation.api=e.continuation?.api??void 0,this._continuation.token=e.continuation?.token??void 0,this._continuation.clientVersion=e.continuation?.clientVersion??"<important data>"}__patchSearch(e){this.id=e.id||void 0,this.url=this.id?`https://www.youtube.com/playlist?list=${this.id}`:void 0,this.title=e.title||void 0,this.thumbnail=new L(e.thumbnail)||void 0,this.channel=e.channel||void 0,this.videos=[],this.videoCount=e.videos||0,this.link=void 0,this.lastUpdate=void 0,this.views=0}async next(e=1/0){if(!this._continuation||!this._continuation.token)return[];let i=await u(`${Ct}${this._continuation.api}`,{method:"POST",body:JSON.stringify({continuation:this._continuation.token,context:{client:{utcOffsetMinutes:0,gl:"US",hl:"en",clientName:"WEB",clientVersion:this._continuation.clientVersion},user:{},request:{}}})}),r=JSON.parse(i)?.onResponseReceivedActions[0]?.appendContinuationItemsAction?.continuationItems;if(!r)return[];let s=se(r,e);return this.fetched_videos.set(`${this.__count}`,s),this._continuation.token=K(r),s}async fetch(e=1/0){if(!this._continuation.token)return this;for(e<1&&(e=1/0);typeof this._continuation.token=="string"&&this._continuation.token.length;){this.__count++;let r=await this.next();if(e-=r.length,e<=0||!r.length)break}return this}page(e){if(!e)throw new Error("Page number is not provided");if(!this.fetched_videos.has(`${e}`))throw new Error("Given Page number is invalid");return this.fetched_videos.get(`${e}`)}get total_pages(){return this.fetched_videos.size}get total_videos(){let e=this.total_pages;return(e-1)*100+this.fetched_videos.get(`${e}`).length}toJSON(){return{id:this.id,title:this.title,thumbnail:this.thumbnail?.toJSON()||this.thumbnail,channel:this.channel,url:this.url,videos:this.videos}}};a(x,"YouTubePlayList");var Oe=/^[a-zA-Z\d_-]{11,12}$/,Rt=/^(PL|UU|LL|RD|OL)[a-zA-Z\d_-]{10,}$/,Ce="AIzaSyAO_FJ2SlqU8Q4STEHLGCilw_Y9_11qcW8",Pt=/^((?:https?:)?\/\/)?(?:(?:www|m|music)\.)?((?:youtube\.com|youtu.be))(\/(?:[\w\-]+\?v=|shorts\/|embed\/|v\/)?)([\w\-]+)(\S+)?$/,zt=/^((?:https?:)?\/\/)?(?:(?:www|m)\.)?(youtube\.com)\/(?:(playlist|watch))(.*)?((\?|\&)list=)(PL|UU|LL|RD|OL)[a-zA-Z\d_-]{10,}(.*)?$/;function P(t){if(t.indexOf("list=")===-1)if(t.startsWith("https"))if(t.match(Pt)){let e;return t.includes("youtu.be/")?e=t.split("youtu.be/")[1].split(/(\?|\/|&)/)[0]:t.includes("youtube.com/embed/")?e=t.split("youtube.com/embed/")[1].split(/(\?|\/|&)/)[0]:t.includes("youtube.com/shorts/")?e=t.split("youtube.com/shorts/")[1].split(/(\?|\/|&)/)[0]:e=t.split("watch?v=")[1].split(/(\?|\/|&)/)[0],e.match(Oe)?"video":!1}else return!1;else return t.match(Oe)?"video":t.match(Rt)?"playlist":"search";else return t.match(zt)?"playlist":!1}a(P,"yt_validate");function B(t){let e=P(t);if(!e||e==="search")throw new Error("This is not a YouTube url or videoId or PlaylistID");if(t.startsWith("https"))if(t.indexOf("list=")===-1){let i;return t.includes("youtu.be/")?i=t.split("youtu.be/")[1].split(/(\?|\/|&)/)[0]:t.includes("youtube.com/embed/")?i=t.split("youtube.com/embed/")[1].split(/(\?|\/|&)/)[0]:t.includes("youtube.com/shorts/")?i=t.split("youtube.com/shorts/")[1].split(/(\?|\/|&)/)[0]:i=t.split("watch?v=")[1].split(/(\?|\/|&)/)[0],i}else return t.split("list=")[1].split("&")[0];else return t}a(B,"extractID");async function H(t,e={}){if(typeof t!="string")throw new Error("url parameter is not a URL string or a string of HTML");let i;if(e.htmldata)i=t;else{if(P(t)!=="video")throw new Error("This is not a YouTube Watch URL");let rt=`https://www.youtube.com/watch?v=${B(t)}&has_verified=1`;i=await u(rt,{headers:{"accept-language":e.language||"en-US;q=0.9"},cookies:!0})}if(i.indexOf("Our systems have detected unusual traffic from your computer network.")!==-1)throw new Error("Captcha page: YouTube has detected that you are a bot!");let r=i.split("var ytInitialPlayerResponse = ")?.[1]?.split(";<\/script>")[0].split(/;\s*(var|const|let)\s/)[0];if(!r)throw new Error("Initial Player Response Data is undefined.");let s=i.split("var ytInitialData = ")?.[1]?.split(";<\/script>")[0].split(/;\s*(var|const|let)\s/)[0];if(!s)throw new Error("Initial Response Data is undefined.");let n=JSON.parse(r),o=JSON.parse(s);if(n.playabilityStatus.status!=="OK")throw new Error(`While getting info from url
${n.playabilityStatus.errorScreen.playerErrorMessageRenderer?.reason.simpleText??n.playabilityStatus.errorScreen.playerKavRenderer?.reason.simpleText}`);let l=o.contents.twoColumnWatchNextResults.results?.results?.contents[1]?.videoSecondaryInfoRenderer?.owner?.videoOwnerRenderer,d=l?.badges?.[0]?.metadataBadgeRenderer?.style?.toLowerCase(),c=`https://www.youtube.com${i.split('"jsUrl":"')[1].split('"')[0]}`,k=[];o.contents.twoColumnWatchNextResults.secondaryResults.secondaryResults.results.forEach(A=>{A.compactVideoRenderer&&k.push(`https://www.youtube.com/watch?v=${A.compactVideoRenderer.videoId}`)});let p=n.videoDetails,b=n.microformat.playerMicroformatRenderer,O=new S({id:p.videoId,title:p.title,description:p.shortDescription,duration:Number(p.lengthSeconds),duration_raw:Nt(p.lengthSeconds),uploadedAt:b.publishDate,thumbnails:p.thumbnail.thumbnails,channel:{name:p.author,id:p.channelId,url:`https://www.youtube.com/channel/${p.channelId}`,verified:Boolean(d?.includes("verified")),artist:Boolean(d?.includes("artist")),icons:l?.thumbnail?.thumbnails||void 0},views:p.viewCount,tags:p.keywords,likes:parseInt(o.contents.twoColumnWatchNextResults.results.results.contents.find(A=>A.videoPrimaryInfoRenderer)?.videoPrimaryInfoRenderer.videoActions.menuRenderer.topLevelButtons?.find(A=>A.toggleButtonRenderer.defaultIcon.iconType==="LIKE")?.toggleButtonRenderer.defaultText.accessibility?.accessibilityData.label.replace(/\D+/g,"")??0),live:p.isLiveContent,private:p.isPrivate}),I=n.streamingData.formats??[];return I.push(...n.streamingData.adaptiveFormats??[]),{LiveStreamData:{isLive:O.live,dashManifestUrl:n.streamingData?.dashManifestUrl??null,hlsManifestUrl:n.streamingData?.hlsManifestUrl??null},html5player:c,format:I,video_details:O,related_videos:k}}a(H,"video_basic_info");async function Re(t,e={}){if(typeof t!="string")throw new Error("url parameter is not a URL string or a string of HTML");let i;if(e.htmldata)i=t;else{if(P(t)!=="video")throw new Error("This is not a YouTube Watch URL");let p=`https://www.youtube.com/watch?v=${B(t)}&has_verified=1`;i=await u(p,{headers:{"accept-language":"en-US,en;q=0.9"},cookies:!0})}if(i.indexOf("Our systems have detected unusual traffic from your computer network.")!==-1)throw new Error("Captcha page: YouTube has detected that you are a bot!");let r=i.split("var ytInitialPlayerResponse = ")?.[1]?.split(";<\/script>")[0].split(/;\s*(var|const|let)\s/)[0];if(!r)throw new Error("Initial Player Response Data is undefined.");let s=JSON.parse(r);if(s.playabilityStatus.status!=="OK")throw new Error(`While getting info from url
${s.playabilityStatus.errorScreen.playerErrorMessageRenderer?.reason.simpleText??s.playabilityStatus.errorScreen.playerKavRenderer?.reason.simpleText}`);let n=`https://www.youtube.com${i.split('"jsUrl":"')[1].split('"')[0]}`,o=Number(s.videoDetails.lengthSeconds),l={url:`https://www.youtube.com/watch?v=${s.videoDetails.videoId}`,durationInSec:(o<0?0:o)||0},d=s.streamingData.formats??[];d.push(...s.streamingData.adaptiveFormats??[]);let c={isLive:s.videoDetails.isLiveContent,dashManifestUrl:s.streamingData?.dashManifestUrl??null,hlsManifestUrl:s.streamingData?.hlsManifestUrl??null};return await V({LiveStreamData:c,html5player:n,format:d,video_details:l})}a(Re,"video_stream_info");function Nt(t){let e=Number(t),i=Math.floor(e/3600),r=Math.floor(e%3600/60),s=Math.floor(e%3600%60),n=i>0?(i<10?`0${i}`:i)+":":"",o=r>0?(r<10?`0${r}`:r)+":":"00:",l=s>0?s<10?`0${s}`:s:"00";return n+o+l}a(Nt,"parseSeconds");async function C(t,e={}){let i=await H(t,e);return await V(i)}a(C,"video_info");async function V(t){return t.LiveStreamData.isLive===!0&&t.LiveStreamData.dashManifestUrl!==null&&t.video_details.durationInSec===0||(t.format[0].signatureCipher||t.format[0].cipher)&&(t.format=await $e(t.format,t.html5player)),t}a(V,"decipher_info");async function ne(t,e={}){if(!t||typeof t!="string")throw new Error(`Expected playlist url, received ${typeof t}!`);if(t.startsWith("https")||(t=`https://www.youtube.com/playlist?list=${t}`),t.indexOf("list=")===-1)throw new Error("This is not a Playlist URL");P(t)==="playlist"&&(t=`https://www.youtube.com/playlist?list=${B(t)}`);let i=await u(t,{headers:{"accept-language":e.language||"en-US;q=0.9"}});if(i.indexOf("Our systems have detected unusual traffic from your computer network.")!==-1)throw new Error("Captcha page: YouTube has detected that you are a bot!");let r=JSON.parse(i.split("var ytInitialData = ")[1].split(";<\/script>")[0].split(/;\s*(var|const|let)\s/)[0]);if(r.alerts)if(r.alerts[0].alertWithButtonRenderer?.type==="INFO"){if(!e.incomplete)throw new Error(`While parsing playlist url
${r.alerts[0].alertWithButtonRenderer.text.simpleText}`)}else throw r.alerts[0].alertRenderer?.type==="ERROR"?new Error(`While parsing playlist url
${r.alerts[0].alertRenderer.text.runs[0].text}`):new Error(`While parsing playlist url
Unknown Playlist Error`);return t.indexOf("watch?v=")!==-1?At(r,i):Lt(r,i)}a(ne,"playlist_info");function se(t,e=1/0){let i=[];for(let r=0;r<t.length&&e!==i.length;r++){let s=t[r].playlistVideoRenderer;!s||!s.shortBylineText||i.push(new S({id:s.videoId,duration:parseInt(s.lengthSeconds)||0,duration_raw:s.lengthText?.simpleText??"0:00",thumbnails:s.thumbnail.thumbnails,title:s.title.runs[0].text,channel:{id:s.shortBylineText.runs[0].navigationEndpoint.browseEndpoint.browseId||void 0,name:s.shortBylineText.runs[0].text||void 0,url:`https://www.youtube.com${s.shortBylineText.runs[0].navigationEndpoint.browseEndpoint.canonicalBaseUrl||s.shortBylineText.runs[0].navigationEndpoint.commandMetadata.webCommandMetadata.url}`,icon:void 0}}))}return i}a(se,"getPlaylistVideos");function K(t){return t.find(e=>Object.keys(e)[0]==="continuationItemRenderer")?.continuationItemRenderer.continuationEndpoint?.continuationCommand?.token}a(K,"getContinuationToken");function At(t,e){let i=t.contents.twoColumnWatchNextResults.playlist.playlist,r=Mt(i.contents),s=e.split('INNERTUBE_API_KEY":"')[1]?.split('"')[0]??e.split('innertubeApiKey":"')[1]?.split('"')[0]??Ce,n=i.totalVideos,o=i.shortBylineText?.runs?.[0],l=i.badges?.[0]?.metadataBadgeRenderer?.style.toLowerCase();return new x({continuation:{api:s,token:K(i.contents),clientVersion:e.split('"INNERTUBE_CONTEXT_CLIENT_VERSION":"')[1]?.split('"')[0]??e.split('"innertube_context_client_version":"')[1]?.split('"')[0]??"<some version>"},id:i.playlistId||"",title:i.title||"",videoCount:parseInt(n)||0,videos:r,url:`https://www.youtube.com/playlist?list=${i.playlistId}`,channel:{id:o?.navigationEndpoint?.browseEndpoint?.browseId||null,name:o?.text||null,url:`https://www.youtube.com${o?.navigationEndpoint?.browseEndpoint?.canonicalBaseUrl||o?.navigationEndpoint?.commandMetadata?.webCommandMetadata?.url}`,verified:Boolean(l?.includes("verified")),artist:Boolean(l?.includes("artist"))}})}a(At,"getWatchPlaylist");function Lt(t,e){let i=t.contents.twoColumnBrowseResultsRenderer.tabs[0].tabRenderer.content.sectionListRenderer.contents[0].itemSectionRenderer.contents[0].playlistVideoListRenderer.contents,r=t.sidebar.playlistSidebarRenderer.items,s=e.split('INNERTUBE_API_KEY":"')[1]?.split('"')[0]??e.split('innertubeApiKey":"')[1]?.split('"')[0]??Ce,n=se(i,100),o=r[0].playlistSidebarPrimaryInfoRenderer;if(!o.title.runs||!o.title.runs.length)throw new Error("Failed to Parse Playlist info.");let l=r[1]?.playlistSidebarSecondaryInfoRenderer.videoOwner,d=o.stats.length===3?o.stats[1].simpleText.replace(/[^0-9]/g,""):0,c=o.stats.find(b=>"runs"in b&&b.runs.find(O=>O.text.toLowerCase().includes("last update")))?.runs.pop()?.text??null,k=o.stats[0].runs[0].text.replace(/[^0-9]/g,"")||0;return new x({continuation:{api:s,token:K(i),clientVersion:e.split('"INNERTUBE_CONTEXT_CLIENT_VERSION":"')[1]?.split('"')[0]??e.split('"innertube_context_client_version":"')[1]?.split('"')[0]??"<some version>"},id:o.title.runs[0].navigationEndpoint.watchEndpoint.playlistId,title:o.title.runs[0].text,videoCount:parseInt(k)||0,lastUpdate:c,views:parseInt(d)||0,videos:n,url:`https://www.youtube.com/playlist?list=${o.title.runs[0].navigationEndpoint.watchEndpoint.playlistId}`,link:`https://www.youtube.com${o.title.runs[0].navigationEndpoint.commandMetadata.webCommandMetadata.url}`,channel:l?{name:l.videoOwnerRenderer.title.runs[0].text,id:l.videoOwnerRenderer.title.runs[0].navigationEndpoint.browseEndpoint.browseId,url:`https://www.youtube.com${l.videoOwnerRenderer.navigationEndpoint.commandMetadata.webCommandMetadata.url||l.videoOwnerRenderer.navigationEndpoint.browseEndpoint.canonicalBaseUrl}`,icon:l.videoOwnerRenderer.thumbnail.thumbnails.length?l.videoOwnerRenderer.thumbnail.thumbnails[l.videoOwnerRenderer.thumbnail.thumbnails.length-1].url:null}:{},thumbnail:o.thumbnailRenderer.playlistVideoThumbnailRenderer?.thumbnail.thumbnails.length?o.thumbnailRenderer.playlistVideoThumbnailRenderer.thumbnail.thumbnails[o.thumbnailRenderer.playlistVideoThumbnailRenderer.thumbnail.thumbnails.length-1]:null})}a(Lt,"getNormalPlaylist");function Mt(t,e=1/0){let i=[];for(let r=0;r<t.length&&e!==i.length;r++){let s=t[r].playlistPanelVideoRenderer;if(!s||!s.shortBylineText)continue;let n=s.shortBylineText.runs[0];i.push(new S({id:s.videoId,duration:qt(s.lengthText?.simpleText)||0,duration_raw:s.lengthText?.simpleText??"0:00",thumbnails:s.thumbnail.thumbnails,title:s.title.simpleText,channel:{id:n.navigationEndpoint.browseEndpoint.browseId||void 0,name:n.text||void 0,url:`https://www.youtube.com${n.navigationEndpoint.browseEndpoint.canonicalBaseUrl||n.navigationEndpoint.commandMetadata.webCommandMetadata.url}`,icon:void 0}}))}return i}a(Mt,"getWatchPlaylistVideos");function qt(t){if(!t)return 0;let e=t.split(":");switch(e.length){case 2:return parseInt(e[0])*60+parseInt(e[1]);case 3:return parseInt(e[0])*60*60+parseInt(e[1])*60+parseInt(e[2]);default:return 0}}a(qt,"parseDuration");import{WebmElements as Pe,WebmHeader as Yt}from"play-audio";import{Duplex as Ut}from"stream";var oe=(i=>(i.READING_HEAD="READING_HEAD",i.READING_DATA="READING_DATA",i))(oe||{}),Z=class extends Ut{constructor(e){super(e);this.state="READING_HEAD",this.cursor=0,this.header=new Yt,this.headfound=!1,this.time_left=0,this.headerparsed=!1,this.seekfound=!1,this.data_length=0,this.mode=e.mode||"granular",this.data_size=0}get vint_length(){let e=0;for(;e<8&&!(1<<7-e&this.chunk[this.cursor]);e++);return++e}get vint_value(){if(!this.chunk)return!1;let e=this.vint_length;if(this.chunk.length<this.cursor+e)return!1;let i=this.chunk[this.cursor]&(1<<8-e)-1;for(let r=this.cursor+1;r<this.cursor+e;r++)i=(i<<8)+this.chunk[r];return this.data_size=e,this.data_length=i,!0}cleanup(){this.cursor=0,this.chunk=void 0,this.remaining=void 0}_read(){}seek(e){let i=0,r=Math.floor(e/10)*10;if(this.time_left=(e-r)*1e3||0,!this.header.segment.cues)return new Error("Failed to Parse Cues");for(let s of this.header.segment.cues)if(Math.floor(s.time/1e3)===r){i=s.position;break}else continue;return i===0?Error("Failed to find Cluster Position"):i}_write(e,i,r){this.remaining?(this.chunk=Buffer.concat([this.remaining,e]),this.remaining=void 0):this.chunk=e;let s;this.state==="READING_HEAD"?s=this.readHead():this.seekfound?s=this.readTag():s=this.getClosetCluster(),s?r(s):r()}readHead(){if(!this.chunk)return new Error("Chunk is missing");for(;this.chunk.length>this.cursor;){let e=this.cursor,i=this.vint_length;if(this.chunk.length<this.cursor+i)break;let r=this.parseEbmlID(this.chunk.slice(this.cursor,this.cursor+i).toString("hex"));if(this.cursor+=i,!this.vint_value){this.cursor=e;break}if(!r){this.cursor+=this.data_size+this.data_length;continue}if(!this.headfound)if(r.name==="ebml")this.headfound=!0;else return new Error("Failed to find EBML ID at start of stream.");let n=this.chunk.slice(this.cursor+this.data_size,this.cursor+this.data_size+this.data_length),o=this.header.parse(r,n);if(o instanceof Error)return o;if(r.type===0){this.cursor+=this.data_size;continue}if(this.chunk.length<this.cursor+this.data_size+this.data_length){this.cursor=e;break}else this.cursor+=this.data_size+this.data_length}this.remaining=this.chunk.slice(this.cursor),this.cursor=0}readTag(){if(!this.chunk)return new Error("Chunk is missing");for(;this.chunk.length>this.cursor;){let e=this.cursor,i=this.vint_length;if(this.chunk.length<this.cursor+i)break;let r=this.parseEbmlID(this.chunk.slice(this.cursor,this.cursor+i).toString("hex"));if(this.cursor+=i,!this.vint_value){this.cursor=e;break}if(!r){this.cursor+=this.data_size+this.data_length;continue}let n=this.chunk.slice(this.cursor+this.data_size,this.cursor+this.data_size+this.data_length),o=this.header.parse(r,n);if(o instanceof Error)return o;if(r.type===0){this.cursor+=this.data_size;continue}if(this.chunk.length<this.cursor+this.data_size+this.data_length){this.cursor=e;break}else this.cursor+=this.data_size+this.data_length;if(r.name==="simpleBlock"){if(this.time_left!==0&&this.mode==="precise")if(n.readUInt16BE(1)===this.time_left)this.time_left=0;else continue;let l=this.header.segment.tracks[this.header.audioTrack];if(!l||l.trackType!==2)return new Error("No audio Track in this webm file.");(n[0]&15)===l.trackNumber&&this.push(n.slice(4))}}this.remaining=this.chunk.slice(this.cursor),this.cursor=0}getClosetCluster(){if(!this.chunk)return new Error("Chunk is missing");let e=this.chunk.indexOf("1f43b675",0,"hex");if(e===-1)throw new Error("Failed to find nearest Cluster.");return this.chunk=this.chunk.slice(e),this.seekfound=!0,this.readTag()}parseEbmlID(e){return Object.keys(Pe).includes(e)?Pe[e]:!1}_destroy(e,i){this.cleanup(),i(e)}_final(e){this.cleanup(),e()}};a(Z,"WebmSeeker");var Q=class{constructor(e,i,r,s,n){this.stream=new Z({highWaterMark:5*1e3*1e3,readableObjectMode:!0,mode:n.seekMode}),this.url=e,this.quality=n.quality,this.type=_.Opus,this.bytes_count=0,this.video_url=s,this.per_sec_bytes=Math.ceil(r/i),this.content_length=r,this.request=null,this.timer=new $(()=>{this.timer.reuse(),this.loop()},265),this.stream.on("close",()=>{this.timer.destroy(),this.cleanup()}),this.seek(n.seek)}async seek(e){await new Promise(async r=>{if(this.stream.headerparsed)r("");else{let s=await D(this.url,{headers:{range:"bytes=0-1000"}}).catch(n=>n);if(s instanceof Error){this.stream.emit("error",s),this.bytes_count=0,this.per_sec_bytes=0,this.cleanup();return}this.request=s,s.pipe(this.stream,{end:!1}),s.once("end",()=>{this.stream.state=oe.READING_DATA,r("")})}});let i=this.stream.seek(e);if(i instanceof Error){this.stream.emit("error",i),this.bytes_count=0,this.per_sec_bytes=0,this.cleanup();return}this.stream.seekfound=!1,this.bytes_count=i,this.timer.reuse(),this.loop()}async retry(){let e=await C(this.video_url),i=J(e.format);this.url=i[this.quality].url}cleanup(){this.request?.destroy(),this.request=null,this.url=""}async loop(){if(this.stream.destroyed){this.timer.destroy(),this.cleanup();return}let e=this.bytes_count+this.per_sec_bytes*300,i=await D(this.url,{headers:{range:`bytes=${this.bytes_count}-${e>=this.content_length?"":e}`}}).catch(r=>r);if(i instanceof Error){this.stream.emit("error",i),this.bytes_count=0,this.per_sec_bytes=0,this.cleanup();return}if(Number(i.statusCode)>=400){this.cleanup(),await this.retry(),this.timer.reuse(),this.loop();return}this.request=i,i.pipe(this.stream,{end:!1}),i.once("error",async()=>{this.cleanup(),await this.retry(),this.timer.reuse(),this.loop()}),i.on("data",r=>{this.bytes_count+=r.length}),i.on("end",()=>{e>=this.content_length&&(this.timer.destroy(),this.stream.end(),this.cleanup())})}pause(){this.timer.pause()}resume(){this.timer.resume()}};a(Q,"SeekStream");var _=(n=>(n.Arbitrary="arbitrary",n.Raw="raw",n.OggOpus="ogg/opus",n.WebmOpus="webm/opus",n.Opus="opus",n))(_||{});function J(t){let e=[];return t.forEach(i=>{let r=i.mimeType;r.startsWith("audio")&&(i.codec=r.split('codecs="')[1].split('"')[0],i.container=r.split("audio/")[1].split(";")[0],e.push(i))}),e}a(J,"parseAudioFormats");async function X(t,e={}){let i=await Re(t,{htmldata:e.htmldata,language:e.language});return await ee(i,e)}a(X,"stream");async function ee(t,e={}){let i=[];if(t.LiveStreamData.isLive===!0&&t.LiveStreamData.dashManifestUrl!==null&&t.video_details.durationInSec===0)return new F(t.LiveStreamData.dashManifestUrl,t.format[t.format.length-1].targetDurationSec,t.video_details.url);let r=J(t.format);typeof e.quality!="number"?e.quality=r.length-1:e.quality<=0?e.quality=0:e.quality>=r.length&&(e.quality=r.length-1),r.length!==0?i.push(r[e.quality]):i.push(t.format[t.format.length-1]);let s=i[0].codec==="opus"&&i[0].container==="webm"?"webm/opus":"arbitrary";if(e.seek)if(s==="webm/opus"){if(e.seek>=t.video_details.durationInSec||e.seek<=0)throw new Error(`Seeking beyond limit. [ 1 - ${t.video_details.durationInSec-1}]`);return new Q(i[0].url,t.video_details.durationInSec,Number(i[0].contentLength),t.video_details.url,e)}else throw new Error("Seek is only supported in Webm Opus Files.");else return new G(i[0].url,s,t.video_details.durationInSec,Number(i[0].contentLength),t.video_details.url,e)}a(ee,"stream_from_info");function ze(t,e){if(!t)throw new Error("Can't parse Search result without data");e?e.type||(e.type="video"):e={type:"video",limit:0};let i=typeof e.limit=="number"&&e.limit>0,r=t.split("var ytInitialData = ")?.[1]?.split(";<\/script>")[0].split(/;\s*(var|const|let)\s/)[0],s=JSON.parse(r),n=[],o=s.contents.twoColumnSearchResultsRenderer.primaryContents.sectionListRenderer.contents[0].itemSectionRenderer.contents;for(let l of o){if(i&&n.length===e.limit)break;if(!(!l.videoRenderer&&!l.channelRenderer&&!l.playlistRenderer))switch(e.type){case"video":{let d=Jt(l);d&&n.push(d);break}case"channel":{let d=Bt(l);d&&n.push(d);break}case"playlist":{let d=jt(l);d&&n.push(d);break}default:throw new Error(`Unknown search type: ${e.type}`)}}return n}a(ze,"ParseSearchResult");function Wt(t){if(!t)return 0;let e=t.split(":"),i=0;switch(e.length){case 3:i=parseInt(e[0])*60*60+parseInt(e[1])*60+parseInt(e[2]);break;case 2:i=parseInt(e[0])*60+parseInt(e[1]);break;default:i=parseInt(e[0])}return i}a(Wt,"parseDuration");function Bt(t){if(!t||!t.channelRenderer)throw new Error("Failed to Parse YouTube Channel");let e=t.channelRenderer.ownerBadges?.[0]?.metadataBadgeRenderer?.style?.toLowerCase(),i=`https://www.youtube.com${t.channelRenderer.navigationEndpoint.browseEndpoint.canonicalBaseUrl||t.channelRenderer.navigationEndpoint.commandMetadata.webCommandMetadata.url}`,r=t.channelRenderer.thumbnail.thumbnails[t.channelRenderer.thumbnail.thumbnails.length-1];return new v({id:t.channelRenderer.channelId,name:t.channelRenderer.title.simpleText,icon:{url:r.url.replace("//","https://"),width:r.width,height:r.height},url:i,verified:Boolean(e?.includes("verified")),artist:Boolean(e?.includes("artist")),subscribers:t.channelRenderer.subscriberCountText?.simpleText??"0 subscribers"})}a(Bt,"parseChannel");function Jt(t){if(!t||!t.videoRenderer)throw new Error("Failed to Parse YouTube Video");let e=t.videoRenderer.ownerText.runs[0],i=t.videoRenderer.ownerBadges?.[0]?.metadataBadgeRenderer?.style?.toLowerCase(),r=t.videoRenderer.lengthText;return new S({id:t.videoRenderer.videoId,url:`https://www.youtube.com/watch?v=${t.videoRenderer.videoId}`,title:t.videoRenderer.title.runs[0].text,description:t.videoRenderer.detailedMetadataSnippets?.[0].snippetText.runs.length?t.videoRenderer.detailedMetadataSnippets[0].snippetText.runs.map(n=>n.text).join(""):"",duration:r?Wt(r.simpleText):0,duration_raw:r?r.simpleText:null,thumbnails:t.videoRenderer.thumbnail.thumbnails,channel:{id:e.navigationEndpoint.browseEndpoint.browseId||null,name:e.text||null,url:`https://www.youtube.com${e.navigationEndpoint.browseEndpoint.canonicalBaseUrl||e.navigationEndpoint.commandMetadata.webCommandMetadata.url}`,icons:t.videoRenderer.channelThumbnailSupportedRenderers.channelThumbnailWithLinkRenderer.thumbnail.thumbnails,verified:Boolean(i?.includes("verified")),artist:Boolean(i?.includes("artist"))},uploadedAt:t.videoRenderer.publishedTimeText?.simpleText??null,views:t.videoRenderer.viewCountText?.simpleText?.replace(/[^0-9]/g,"")??0,live:!r})}a(Jt,"parseVideo");function jt(t){if(!t||!t.playlistRenderer)throw new Error("Failed to Parse YouTube Playlist");let e=t.playlistRenderer.thumbnails[0].thumbnails[t.playlistRenderer.thumbnails[0].thumbnails.length-1],i=t.playlistRenderer.shortBylineText.runs?.[0];return new x({id:t.playlistRenderer.playlistId,title:t.playlistRenderer.title.simpleText,thumbnail:{id:t.playlistRenderer.playlistId,url:e.url,height:e.height,width:e.width},channel:{id:i?.navigationEndpoint.browseEndpoint.browseId,name:i?.text,url:`https://www.youtube.com${i?.navigationEndpoint.commandMetadata.webCommandMetadata.url}`},videos:parseInt(t.playlistRenderer.videoCount.replace(/[^0-9]/g,""))},!0)}a(jt,"parsePlaylist");async function Ne(t,e={}){let i="https://www.youtube.com/results?search_query="+t;if(e.type??="video",i.indexOf("&sp=")===-1)switch(i+="&sp=",e.type){case"channel":i+="EgIQAg%253D%253D";break;case"playlist":i+="EgIQAw%253D%253D";break;case"video":i+="EgIQAQ%253D%253D";break;default:throw new Error(`Unknown search type: ${e.type}`)}let r=await u(i,{headers:{"accept-language":e.language||"en-US;q=0.9"}});if(r.indexOf("Our systems have detected unusual traffic from your computer network.")!==-1)throw new Error("Captcha page: YouTube has detected that you are a bot!");return ze(r,e)}a(Ne,"yt_search");var T=class{constructor(e){this.name=e.name,this.id=e.id,this.type="track",this.url=e.external_urls.spotify,this.explicit=e.explicit,this.durationInMs=e.duration_ms,this.durationInSec=Math.round(this.durationInMs/1e3);let i=[];e.artists.forEach(r=>{i.push({name:r.name,id:r.id,url:r.external_urls.spotify})}),this.artists=i,e.album?.name?this.album={name:e.album.name,url:e.external_urls.spotify,id:e.album.id,release_date:e.album.release_date,release_date_precision:e.album.release_date_precision,total_tracks:e.album.total_tracks}:this.album=void 0,e.album?.images?.[0]?this.thumbnail=e.album.images[0]:this.thumbnail=void 0}toJSON(){return{name:this.name,id:this.id,url:this.url,explicit:this.explicit,durationInMs:this.durationInMs,durationInSec:this.durationInSec,artists:this.artists,album:this.album,thumbnail:this.thumbnail}}};a(T,"SpotifyTrack");var M=class{constructor(e,i,r){this.name=e.name,this.type="playlist",this.search=r,this.collaborative=e.collaborative,this.description=e.description,this.url=e.external_urls.spotify,this.id=e.id,this.thumbnail=e.images[0],this.owner={name:e.owner.display_name,url:e.owner.external_urls.spotify,id:e.owner.id},this.tracksCount=Number(e.tracks.total);let s=[];this.search||e.tracks.items.forEach(n=>{n.track&&s.push(new T(n.track))}),this.fetched_tracks=new Map,this.fetched_tracks.set("1",s),this.spotifyData=i}async fetch(){if(this.search)return this;let e;if(this.tracksCount>1e3?e=1e3:e=this.tracksCount,e<=100)return this;let i=[];for(let r=2;r<=Math.ceil(e/100);r++)i.push(new Promise(async(s,n)=>{let o=await u(`https://api.spotify.com/v1/playlists/${this.id}/tracks?offset=${(r-1)*100}&limit=100&market=${this.spotifyData.market}`,{headers:{Authorization:`${this.spotifyData.token_type} ${this.spotifyData.access_token}`}}).catch(c=>n(`Response Error : 
${c}`)),l=[];if(typeof o!="string")return;JSON.parse(o).items.forEach(c=>{c.track&&l.push(new T(c.track))}),this.fetched_tracks.set(`${r}`,l),s("Success")}));return await Promise.allSettled(i),this}page(e){if(!e)throw new Error("Page number is not provided");if(!this.fetched_tracks.has(`${e}`))throw new Error("Given Page number is invalid");return this.fetched_tracks.get(`${e}`)}get total_pages(){return this.fetched_tracks.size}get total_tracks(){if(this.search)return this.tracksCount;let e=this.total_pages;return(e-1)*100+this.fetched_tracks.get(`${e}`).length}toJSON(){return{name:this.name,collaborative:this.collaborative,description:this.description,url:this.url,id:this.id,thumbnail:this.thumbnail,owner:this.owner,tracksCount:this.tracksCount}}};a(M,"SpotifyPlaylist");var q=class{constructor(e,i,r){this.name=e.name,this.type="album",this.id=e.id,this.search=r,this.url=e.external_urls.spotify,this.thumbnail=e.images[0];let s=[];e.artists.forEach(o=>{s.push({name:o.name,id:o.id,url:o.external_urls.spotify})}),this.artists=s,this.copyrights=e.copyrights,this.release_date=e.release_date,this.release_date_precision=e.release_date_precision,this.tracksCount=e.total_tracks;let n=[];this.search||e.tracks.items.forEach(o=>{n.push(new T(o))}),this.fetched_tracks=new Map,this.fetched_tracks.set("1",n),this.spotifyData=i}async fetch(){if(this.search)return this;let e;if(this.tracksCount>500?e=500:e=this.tracksCount,e<=50)return this;let i=[];for(let r=2;r<=Math.ceil(e/50);r++)i.push(new Promise(async(s,n)=>{let o=await u(`https://api.spotify.com/v1/albums/${this.id}/tracks?offset=${(r-1)*50}&limit=50&market=${this.spotifyData.market}`,{headers:{Authorization:`${this.spotifyData.token_type} ${this.spotifyData.access_token}`}}).catch(c=>n(`Response Error : 
${c}`)),l=[];if(typeof o!="string")return;JSON.parse(o).items.forEach(c=>{c&&l.push(new T(c))}),this.fetched_tracks.set(`${r}`,l),s("Success")}));return await Promise.allSettled(i),this}page(e){if(!e)throw new Error("Page number is not provided");if(!this.fetched_tracks.has(`${e}`))throw new Error("Given Page number is invalid");return this.fetched_tracks.get(`${e}`)}get total_pages(){return this.fetched_tracks.size}get total_tracks(){if(this.search)return this.tracksCount;let e=this.total_pages;return(e-1)*100+this.fetched_tracks.get(`${e}`).length}toJSON(){return{name:this.name,id:this.id,type:this.type,url:this.url,thumbnail:this.thumbnail,artists:this.artists,copyrights:this.copyrights,release_date:this.release_date,release_date_precision:this.release_date_precision,tracksCount:this.tracksCount}}};a(q,"SpotifyAlbum");import{existsSync as Vt,readFileSync as Ft,writeFileSync as Ae}from"node:fs";var h;Vt(".data/spotify.data")&&(h=JSON.parse(Ft(".data/spotify.data","utf-8")),h.file=!0);var Le=/^((https:)?\/\/)?open.spotify.com\/(track|album|playlist)\//;async function Me(t){if(!h)throw new Error(`Spotify Data is missing
Did you forgot to do authorization ?`);if(!t.match(Le))throw new Error("This is not a Spotify URL");if(t.indexOf("track/")!==-1){let e=t.split("track/")[1].split("&")[0].split("?")[0],i=await u(`https://api.spotify.com/v1/tracks/${e}?market=${h.market}`,{headers:{Authorization:`${h.token_type} ${h.access_token}`}}).catch(r=>r);if(i instanceof Error)throw i;return new T(JSON.parse(i))}else if(t.indexOf("album/")!==-1){let e=t.split("album/")[1].split("&")[0].split("?")[0],i=await u(`https://api.spotify.com/v1/albums/${e}?market=${h.market}`,{headers:{Authorization:`${h.token_type} ${h.access_token}`}}).catch(r=>r);if(i instanceof Error)throw i;return new q(JSON.parse(i),h,!1)}else if(t.indexOf("playlist/")!==-1){let e=t.split("playlist/")[1].split("&")[0].split("?")[0],i=await u(`https://api.spotify.com/v1/playlists/${e}?market=${h.market}`,{headers:{Authorization:`${h.token_type} ${h.access_token}`}}).catch(r=>r);if(i instanceof Error)throw i;return new M(JSON.parse(i),h,!1)}else throw new Error("URL is out of scope for play-dl.")}a(Me,"spotify");function ae(t){return t.startsWith("https")?t.match(Le)?t.indexOf("track/")!==-1?"track":t.indexOf("album/")!==-1?"album":t.indexOf("playlist/")!==-1?"playlist":!1:!1:"search"}a(ae,"sp_validate");async function qe(t,e){let i=await u("https://accounts.spotify.com/api/token",{headers:{Authorization:`Basic ${Buffer.from(`${t.client_id}:${t.client_secret}`).toString("base64")}`,"Content-Type":"application/x-www-form-urlencoded"},body:`grant_type=authorization_code&code=${t.authorization_code}&redirect_uri=${encodeURI(t.redirect_url)}`,method:"POST"}).catch(s=>s);if(i instanceof Error)throw i;let r=JSON.parse(i);return h={client_id:t.client_id,client_secret:t.client_secret,redirect_url:t.redirect_url,access_token:r.access_token,refresh_token:r.refresh_token,expires_in:Number(r.expires_in),expiry:Date.now()+(r.expires_in-1)*1e3,token_type:r.token_type,market:t.market},e?Ae(".data/spotify.data",JSON.stringify(h,void 0,4)):(console.log(`Client ID : ${h.client_id}`),console.log(`Client Secret : ${h.client_secret}`),console.log(`Refresh Token : ${h.refresh_token}`),console.log(`Market : ${h.market}`),console.log(`
Paste above info in setToken function.`)),!0}a(qe,"SpotifyAuthorize");function Ye(){return Date.now()>=h.expiry}a(Ye,"is_expired");async function Ue(t,e,i=10){let r=[];if(!h)throw new Error(`Spotify Data is missing
Did you forget to do authorization ?`);if(t.length===0)throw new Error("Pass some query to search.");if(i>50||i<0)throw new Error("You crossed limit range of Spotify [ 0 - 50 ]");let s=await u(`https://api.spotify.com/v1/search?type=${e}&q=${t}&limit=${i}&market=${h.market}`,{headers:{Authorization:`${h.token_type} ${h.access_token}`}}).catch(o=>o);if(s instanceof Error)throw s;let n=JSON.parse(s);return e==="track"?n.tracks.items.forEach(o=>{r.push(new T(o))}):e==="album"?n.albums.items.forEach(o=>{r.push(new q(o,h,!0))}):e==="playlist"&&n.playlists.items.forEach(o=>{r.push(new M(o,h,!0))}),r}a(Ue,"sp_search");async function le(){let t=await u("https://accounts.spotify.com/api/token",{headers:{Authorization:`Basic ${Buffer.from(`${h.client_id}:${h.client_secret}`).toString("base64")}`,"Content-Type":"application/x-www-form-urlencoded"},body:`grant_type=refresh_token&refresh_token=${h.refresh_token}`,method:"POST"}).catch(i=>i);if(t instanceof Error)return!1;let e=JSON.parse(t);return h.access_token=e.access_token,h.expires_in=Number(e.expires_in),h.expiry=Date.now()+(e.expires_in-1)*1e3,h.token_type=e.token_type,h.file&&Ae(".data/spotify.data",JSON.stringify(h,void 0,4)),!0}a(le,"refreshToken");function We(t){h=t,h.file=!1,le()}a(We,"setSpotifyToken");import{existsSync as Kt,readFileSync as Ht}from"node:fs";import{Readable as Gt}from"node:stream";var w=class{constructor(e){this.name=e.title,this.id=e.id,this.url=e.uri,this.fetched=!0,this.type="track",this.durationInSec=Math.round(Number(e.duration)/1e3),this.durationInMs=Number(e.duration),e.publisher_metadata?this.publisher={name:e.publisher_metadata.publisher,id:e.publisher_metadata.id,artist:e.publisher_metadata.artist,contains_music:Boolean(e.publisher_metadata.contains_music)||!1,writer_composer:e.publisher_metadata.writer_composer}:this.publisher=null,this.formats=e.media.transcodings,this.user={name:e.user.username,id:e.user.id,type:"user",url:e.user.permalink_url,verified:Boolean(e.user.verified)||!1,description:e.user.description,first_name:e.user.first_name,full_name:e.user.full_name,last_name:e.user.last_name,thumbnail:e.user.avatar_url},this.thumbnail=e.artwork_url}toJSON(){return{name:this.name,id:this.id,url:this.url,fetched:this.fetched,durationInMs:this.durationInMs,durationInSec:this.durationInSec,publisher:this.publisher,formats:this.formats,thumbnail:this.thumbnail,user:this.user}}};a(w,"SoundCloudTrack");var z=class{constructor(e,i){this.name=e.title,this.id=e.id,this.url=e.uri,this.client_id=i,this.type="playlist",this.sub_type=e.set_type,this.durationInSec=Math.round(Number(e.duration)/1e3),this.durationInMs=Number(e.duration),this.user={name:e.user.username,id:e.user.id,type:"user",url:e.user.permalink_url,verified:Boolean(e.user.verified)||!1,description:e.user.description,first_name:e.user.first_name,full_name:e.user.full_name,last_name:e.user.last_name,thumbnail:e.user.avatar_url},this.tracksCount=e.track_count;let r=[];e.tracks.forEach(s=>{s.title?r.push(new w(s)):r.push({id:s.id,fetched:!1,type:"track"})}),this.tracks=r}async fetch(){let e=[];for(let i=0;i<this.tracks.length;i++)this.tracks[i].fetched||e.push(new Promise(async r=>{let s=i,n=await u(`https://api-v2.soundcloud.com/tracks/${this.tracks[i].id}?client_id=${this.client_id}`);this.tracks[s]=new w(JSON.parse(n)),r("")}));return await Promise.allSettled(e),this}get total_tracks(){let e=0;return this.tracks.forEach(i=>{if(i instanceof w)e++;else return}),e}get fetched_tracks(){let e=[];return this.tracks.forEach(i=>{if(i instanceof w)e.push(i);else return}),e}toJSON(){return{name:this.name,id:this.id,sub_type:this.sub_type,url:this.url,durationInMs:this.durationInMs,durationInSec:this.durationInSec,tracksCount:this.tracksCount,user:this.user,tracks:this.tracks}}};a(z,"SoundCloudPlaylist");var Y=class{constructor(e,i=_.Arbitrary){this.stream=new Gt({highWaterMark:5*1e3*1e3,read(){}}),this.type=i,this.url=e,this.downloaded_time=0,this.request=null,this.downloaded_segments=0,this.time=[],this.timer=new $(()=>{this.timer.reuse(),this.start()},280),this.segment_urls=[],this.stream.on("close",()=>{this.cleanup()}),this.start()}async parser(){let e=await u(this.url).catch(r=>r);if(e instanceof Error)throw e;e.split(`
`).forEach(r=>{r.startsWith("#EXTINF:")?this.time.push(parseFloat(r.replace("#EXTINF:",""))):r.startsWith("https")&&this.segment_urls.push(r)})}async start(){if(this.stream.destroyed){this.cleanup();return}this.time=[],this.segment_urls=[],this.downloaded_time=0,await this.parser(),this.segment_urls.splice(0,this.downloaded_segments),this.loop()}async loop(){if(this.stream.destroyed){this.cleanup();return}if(this.time.length===0||this.segment_urls.length===0){this.cleanup(),this.stream.push(null);return}this.downloaded_time+=this.time.shift(),this.downloaded_segments++;let e=await D(this.segment_urls.shift()).catch(i=>i);if(e instanceof Error){this.stream.emit("error",e),this.cleanup();return}this.request=e,e.on("data",i=>{this.stream.push(i)}),e.on("end",()=>{this.downloaded_time>=300||this.loop()}),e.once("error",i=>{this.stream.emit("error",i)})}cleanup(){this.timer.destroy(),this.request?.destroy(),this.url="",this.downloaded_time=0,this.downloaded_segments=0,this.request=null,this.time=[],this.segment_urls=[]}pause(){this.timer.pause()}resume(){this.timer.resume()}};a(Y,"SoundCloudStream");var E;Kt(".data/soundcloud.data")&&(E=JSON.parse(Ht(".data/soundcloud.data","utf-8")));var Be=/^(?:(https?):\/\/)?(?:(?:www|m)\.)?(api\.soundcloud\.com|soundcloud\.com|snd\.sc)\/(.*)$/;async function ue(t){if(!E)throw new Error(`SoundCloud Data is missing
Did you forget to do authorization ?`);if(!t.match(Be))throw new Error("This is not a SoundCloud URL");let e=await u(`https://api-v2.soundcloud.com/resolve?url=${t}&client_id=${E.client_id}`).catch(r=>r);if(e instanceof Error)throw e;let i=JSON.parse(e);if(i.kind!=="track"&&i.kind!=="playlist")throw new Error("This url is out of scope for play-dl.");return i.kind==="track"?new w(i):new z(i,E.client_id)}a(ue,"soundcloud");async function Je(t,e,i=10){let r=await u(`https://api-v2.soundcloud.com/search/${e}?q=${t}&client_id=${E.client_id}&limit=${i}`),s=[];return JSON.parse(r).collection.forEach(o=>{e==="tracks"?s.push(new w(o)):s.push(new z(o,E.client_id))}),s}a(Je,"so_search");async function je(t,e){let i=await ue(t);if(i instanceof z)throw new Error("Streams can't be created from playlist urls");let r=Ke(i.formats);typeof e!="number"?e=r.length-1:e<=0?e=0:e>=r.length&&(e=r.length-1);let s=r[e].url+"?client_id="+E.client_id,n=JSON.parse(await u(s)),o=r[e].format.mime_type.startsWith("audio/ogg")?_.OggOpus:_.Arbitrary;return new Y(n.url,o)}a(je,"stream");async function Ve(){let e=(await u("https://soundcloud.com/")).split('<script crossorigin src="'),i=[];return e.forEach(s=>{s.startsWith("https")&&i.push(s.split('"')[0])}),(await u(i[i.length-1])).split(',client_id:"')[1].split('"')[0]}a(Ve,"getFreeClientID");async function Fe(t,e){let i=Ke(t.formats);typeof e!="number"?e=i.length-1:e<=0?e=0:e>=i.length&&(e=i.length-1);let r=i[e].url+"?client_id="+E.client_id,s=JSON.parse(await u(r)),n=i[e].format.mime_type.startsWith("audio/ogg")?_.OggOpus:_.Arbitrary;return new Y(s.url,n)}a(Fe,"stream_from_info");async function Ge(t){return!(await u(`https://api-v2.soundcloud.com/search?client_id=${t}&q=Rick+Roll&limit=0`).catch(i=>i)instanceof Error)}a(Ge,"check_id");async function ce(t){if(!t.startsWith("https"))return"search";if(!t.match(Be))return!1;let e=await u(`https://api-v2.soundcloud.com/resolve?url=${t}&client_id=${E.client_id}`).catch(r=>r);if(e instanceof Error)return!1;let i=JSON.parse(e);return i.kind==="track"?"track":i.kind==="playlist"?"playlist":!1}a(ce,"so_validate");function Ke(t){let e=[];return t.forEach(i=>{i.format.protocol==="hls"&&e.push(i)}),e}a(Ke,"parseHlsFormats");function He(t){E=t}a(He,"setSoundCloudToken");import{URL as Zt}from"node:url";var y=class{constructor(e,i){this.id=e.id,this.title=e.title,this.shortTitle=e.title_short,this.url=e.link,this.durationInSec=e.duration,this.rank=e.rank,this.explicit=e.explicit_lyrics,this.previewURL=e.preview,this.artist=new N(e.artist),this.album=new he(e.album),this.type="track",this.partial=i,i||(this.trackPosition=e.track_position,this.diskNumber=e.disk_number,this.releaseDate=new Date(e.release_date),this.bpm=e.bpm,this.gain=e.gain,this.contributors=[],e.contributors.forEach(r=>{this.contributors?.push(new N(r))}))}async fetch(){if(!this.partial)return this;let e=await u(`https://api.deezer.com/track/${this.id}/`).catch(r=>r);if(e instanceof Error)throw e;let i=JSON.parse(e);return this.partial=!1,this.trackPosition=i.track_position,this.diskNumber=i.disk_number,this.releaseDate=new Date(i.release_date),this.bpm=i.bpm,this.gain=i.gain,this.contributors=[],i.contributors.forEach(r=>{this.contributors?.push(new N(r))}),this}toJSON(){return{id:this.id,title:this.title,shortTitle:this.shortTitle,url:this.url,durationInSec:this.durationInSec,rank:this.rank,explicit:this.explicit,previewURL:this.previewURL,artist:this.artist,album:this.album,type:this.type,trackPosition:this.trackPosition,diskNumber:this.diskNumber,releaseDate:this.releaseDate,bpm:this.bpm,gain:this.gain,contributors:this.contributors}}};a(y,"DeezerTrack");var U=class{constructor(e,i){if(this.id=e.id,this.title=e.title,this.url=e.link,this.recordType=e.record_type,this.explicit=e.explicit_lyrics,this.artist=new N(e.artist),this.type="album",this.tracksCount=e.nb_tracks,this.contributors=[],this.genres=[],this.tracks=[],this.cover={xl:e.cover_xl,big:e.cover_big,medium:e.cover_medium,small:e.cover_small},this.partial=i,!i){this.upc=e.upc,this.durationInSec=e.duration,this.numberOfFans=e.fans,this.releaseDate=new Date(e.release_date),this.available=e.available,e.contributors.forEach(s=>{this.contributors?.push(new N(s))}),e.genres.data.forEach(s=>{this.genres?.push({name:s.name,picture:{xl:`${s.picture}?size=xl`,big:`${s.picture}?size=big`,medium:`${s.picture}?size=medium`,small:`${s.picture}?size=small`}})});let r={id:this.id,title:this.title,cover_xl:this.cover.xl,cover_big:this.cover.big,cover_medium:this.cover.medium,cover_small:this.cover.small,release_date:e.release_date};e.tracks.data.forEach(s=>{s.album=r,this.tracks.push(new y(s,!0))})}}async fetch(){if(!this.partial)return this;let e=await u(`https://api.deezer.com/album/${this.id}/`).catch(s=>s);if(e instanceof Error)throw e;let i=JSON.parse(e);this.partial=!1,this.upc=i.upc,this.durationInSec=i.duration,this.numberOfFans=i.fans,this.releaseDate=new Date(i.release_date),this.available=i.available,this.contributors=[],this.genres=[],this.tracks=[],i.contributors.forEach(s=>{this.contributors?.push(new N(s))}),i.genres.data.forEach(s=>{this.genres?.push({name:s.name,picture:{xl:`${s.picture}?size=xl`,big:`${s.picture}?size=big`,medium:`${s.picture}?size=medium`,small:`${s.picture}?size=small`}})});let r={id:this.id,title:this.title,cover_xl:this.cover.xl,cover_big:this.cover.big,cover_medium:this.cover.medium,cover_small:this.cover.small,release_date:i.release_date};return i.tracks.data.forEach(s=>{s.album=r,this.tracks.push(new y(s,!0))}),this}toJSON(){return{id:this.id,title:this.title,url:this.url,recordType:this.recordType,explicit:this.explicit,artist:this.artist,cover:this.cover,type:this.type,upc:this.upc,tracksCount:this.tracksCount,durationInSec:this.durationInSec,numberOfFans:this.numberOfFans,releaseDate:this.releaseDate,available:this.available,genres:this.genres,contributors:this.contributors,tracks:this.tracks.map(e=>e.toJSON())}}};a(U,"DeezerAlbum");var W=class{constructor(e,i){this.id=e.id,this.title=e.title,this.public=e.public,this.url=e.link,this.creationDate=new Date(e.creation_date),this.type="playlist",this.tracksCount=e.nb_tracks,this.tracks=[],this.picture={xl:e.picture_xl,big:e.picture_big,medium:e.picture_medium,small:e.picture_small},e.user?this.creator={id:e.user.id,name:e.user.name}:this.creator={id:e.creator.id,name:e.creator.name},this.partial=i,i||(this.description=e.description,this.durationInSec=e.duration,this.isLoved=e.is_loved_track,this.collaborative=e.collaborative,this.fans=e.fans,this.public&&(this.tracks=e.tracks.data.map(r=>new y(r,!0))))}async fetch(){if(!this.partial&&(this.tracks.length===this.tracksCount||!this.public))return this;if(this.partial){let i=await u(`https://api.deezer.com/playlist/${this.id}/`).catch(s=>s);if(i instanceof Error)throw i;let r=JSON.parse(i);this.partial=!1,this.description=r.description,this.durationInSec=r.duration,this.isLoved=r.is_loved_track,this.collaborative=r.collaborative,this.fans=r.fans,this.public&&(this.tracks=r.tracks.data.map(s=>new y(s,!0)))}let e=this.tracks.length;if(this.public&&e!==this.tracksCount){let i=this.tracksCount-e;i>1e3&&(i=1e3);let r=[];for(let o=1;o<=Math.ceil(i/100);o++)r.push(new Promise(async(l,d)=>{let c=await u(`https://api.deezer.com/playlist/${this.id}/tracks?limit=100&index=${o*100}`).catch(b=>d(b));if(typeof c!="string")return;let p=JSON.parse(c).data.map(b=>new y(b,!0));l(p)}));let s=await Promise.allSettled(r),n=[];for(let o of s)if(o.status==="fulfilled")n.push(...o.value);else throw o.reason;this.tracks.push(...n)}return this}toJSON(){return{id:this.id,title:this.title,public:this.public,url:this.url,picture:this.picture,creationDate:this.creationDate,type:this.type,creator:this.creator,tracksCount:this.tracksCount,description:this.description,durationInSec:this.durationInSec,isLoved:this.isLoved,collaborative:this.collaborative,fans:this.fans,tracks:this.tracks.map(e=>e.toJSON())}}};a(W,"DeezerPlaylist");var he=class{constructor(e){this.id=e.id,this.title=e.title,this.url=`https://www.deezer.com/album/${e.id}/`,this.cover={xl:e.cover_xl,big:e.cover_big,medium:e.cover_medium,small:e.cover_small},e.release_date&&(this.releaseDate=new Date(e.release_date))}};a(he,"DeezerTrackAlbum");var N=class{constructor(e){this.id=e.id,this.name=e.name,this.url=e.link?e.link:`https://www.deezer.com/artist/${e.id}/`,e.picture_xl&&(this.picture={xl:e.picture_xl,big:e.picture_big,medium:e.picture_medium,small:e.picture_small}),e.role&&(this.role=e.role)}};a(N,"DeezerArtist");async function de(t){let e;try{e=new Zt(t)}catch{return{type:"search"}}if(e.protocol!=="https:"&&e.protocol!=="http:")return{type:"search"};let i=e.pathname;i.endsWith("/")&&(i=i.slice(0,-1));let r=i.split("/");switch(e.hostname){case"deezer.com":case"www.deezer.com":{if(r.length===4){if(!r.splice(1,1)[0].match(/^[a-z]{2}$/))return{type:!1}}else if(r.length!==3)return{type:!1};return(r[1]==="track"||r[1]==="album"||r[1]==="playlist")&&r[2].match(/^[0-9]+$/)?{type:r[1],id:r[2]}:{type:!1}}case"api.deezer.com":return r.length===3&&(r[1]==="track"||r[1]==="album"||r[1]==="playlist")&&r[2].match(/^[0-9]+$/)?{type:r[1],id:r[2]}:{type:!1};case"deezer.page.link":if(r.length===2&&r[1].match(/^[A-Za-z0-9]+$/)){let s=await ie(t).catch(n=>n);return s instanceof Error?{type:!1,error:s.message}:await de(s)}else return{type:!1};default:return{type:"search"}}}a(de,"internalValidate");async function Ze(t){let e=await de(t);if(e.error)throw new Error(`This is not a Deezer track, playlist or album URL:
${e.error}`);if(!e.type||e.type==="search")throw new Error("This is not a Deezer track, playlist or album URL");let i=await u(`https://api.deezer.com/${e.type}/${e.id}`).catch(s=>s);if(i instanceof Error)throw i;let r=JSON.parse(i);if(r.error)throw new Error(`Deezer API Error: ${r.error.type}: ${r.error.message}`);switch(e.type){case"track":return new y(r,!1);case"playlist":return new W(r,!1);case"album":return new U(r,!1)}}a(Ze,"deezer");async function pe(t){return(await de(t)).type}a(pe,"dz_validate");async function Qe(t,e){let i=t.trim(),r=e.type??"track",s=e.limit??10,n=e.fuzzy??!0;if(i.length===0)throw new Error("A query is required to search.");if(s>100)throw new Error("The maximum search limit for Deezer is 100");if(s<1)throw new Error("The minimum search limit for Deezer is 1");if(r!=="track"&&r!=="album"&&r!="playlist")throw new Error(`"${r}" is not a valid Deezer search type`);i=encodeURIComponent(i);let o=await u(`https://api.deezer.com/search/${r}/?q=${i}&limit=${s}${n?"":"strict=on"}`).catch(c=>c);if(o instanceof Error)throw o;let l=JSON.parse(o);if(l.error)throw new Error(`Deezer API Error: ${l.error.type}: ${l.error.message}`);let d=[];switch(r){case"track":d=l.data.map(c=>new y(c,!0));break;case"playlist":d=l.data.map(c=>new W(c,!0));break;case"album":d=l.data.map(c=>new U(c,!0));break}return d}a(Qe,"dz_search");async function Xe(t){let e=t.limit??10;if(e>100)throw new Error("The maximum search limit for Deezer is 100");if(e<1)throw new Error("The minimum search limit for Deezer is 1");let i=[];if(t.artist&&i.push(`artist:"${encodeURIComponent(t.artist)}"`),t.album&&i.push(`album:"${encodeURIComponent(t.album)}"`),t.title&&i.push(`track:"${encodeURIComponent(t.title)}"`),t.label&&i.push(`label:"${encodeURIComponent(t.label)}"`),isNaN(Number(t.minDurationInSec))||i.push(`dur_min:${t.minDurationInSec}`),isNaN(Number(t.maxDurationInSec))||i.push(`dur_max:${t.maxDurationInSec}`),isNaN(Number(t.minBPM))||i.push(`bpm_min:${t.minBPM}`),isNaN(Number(t.maxBPM))||i.push(`bpm_max:${t.maxBPM}`),i.length===0)throw new Error("At least one type of metadata is required.");let r=await u(`https://api.deezer.com/search/track/?q=${i.join(" ")}&limit=${e}`).catch(o=>o);if(r instanceof Error)throw r;let s=JSON.parse(r);if(s.error)throw new Error(`Deezer API Error: ${s.error.type}: ${s.error.message}`);return s.data.map(o=>new y(o,!0))}a(Xe,"dz_advanced_track_search");function et(t){t.spotify&&We(t.spotify),t.soundcloud&&He(t.soundcloud),t.youtube&&be(t.youtube),t.useragent&&_e(t.useragent)}a(et,"setToken");import{createInterface as Qt}from"node:readline";import{existsSync as me,mkdirSync as fe,writeFileSync as tt}from"node:fs";async function Xt(t,e={}){if(t.length===0)throw new Error("Stream URL has a length of 0. Check your url again.");if(e.htmldata)return await X(t,e);if(t.indexOf("spotify")!==-1)throw new Error("Streaming from Spotify is not supported. Please use search() to find a similar track on YouTube or SoundCloud instead.");if(t.indexOf("deezer")!==-1)throw new Error("Streaming from Deezer is not supported. Please use search() to find a similar track on YouTube or SoundCloud instead.");return t.indexOf("soundcloud")!==-1?await je(t,e.quality):await X(t,e)}a(Xt,"stream");async function ei(t,e={}){if(e.source||(e.source={youtube:"video"}),t=encodeURIComponent(t),e.source.youtube)return await Ne(t,{limit:e.limit,type:e.source.youtube,language:e.language});if(e.source.spotify)return await Ue(t,e.source.spotify,e.limit);if(e.source.soundcloud)return await Je(t,e.source.soundcloud,e.limit);if(e.source.deezer)return await Qe(t,{limit:e.limit,type:e.source.deezer,fuzzy:e.fuzzy});throw new Error("Not possible to reach Here LOL. Easter Egg of play-dl if someone get this.")}a(ei,"search");async function ti(t,e={}){return t instanceof w?await Fe(t,e.quality):await ee(t,e)}a(ti,"stream_from_info");async function ii(t){let e;return t.startsWith("https")?t.indexOf("spotify")!==-1?(e=ae(t),e!==!1?"sp_"+e:!1):t.indexOf("soundcloud")!==-1?(e=await ce(t),e!==!1?"so_"+e:!1):t.indexOf("deezer")!==-1?(e=await pe(t),e!==!1?"dz_"+e:!1):(e=P(t),e!==!1?"yt_"+e:!1):"search"}a(ii,"validate");function ri(){let t=Qt({input:process.stdin,output:process.stdout});t.question("Do you want to save data in a file ? (Yes / No): ",e=>{let i;if(e.toLowerCase()==="yes")i=!0;else if(e.toLowerCase()==="no")i=!1;else{console.log("That option doesn't exist. Try again..."),t.close();return}t.question("Choose your service - sc (for SoundCloud) / sp (for Spotify)  / yo (for YouTube): ",r=>{if(r.toLowerCase().startsWith("sp")){let s,n,o,l;t.question("Start by entering your Client ID : ",d=>{s=d,t.question("Now enter your Client Secret : ",c=>{n=c,t.question("Enter your Redirect URL now : ",k=>{o=k,console.log(`
If you would like to know your region code visit : 
https://en.wikipedia.org/wiki/ISO_3166-1_alpha-2#Officially_assigned_code_elements 
`),t.question("Enter your region code (2-letter country code) : ",p=>{p.length===2?l=p:(console.log("That doesn't look like a valid region code, IN will be selected as default."),l="IN"),console.log(`
Now open your browser and paste the below url, then authorize it and copy the redirected url. 
`),console.log(`https://accounts.spotify.com/authorize?client_id=${s}&response_type=code&redirect_uri=${encodeURI(o)} 
`),t.question("Paste the url which you just copied : ",async b=>{me(".data")||fe(".data");let O={client_id:s,client_secret:n,redirect_url:o,authorization_code:b.split("code=")[1],market:l};if(await qe(O,i)===!1)throw new Error("Failed to get access token.");t.close()})})})})})}else if(r.toLowerCase().startsWith("sc")){if(!i){console.log("You already had a client ID, just paste that in setToken function."),t.close();return}t.question("Client ID : ",async s=>{let n=s;if(!n){console.log("You didn't provide a client ID. Try again..."),t.close();return}me(".data")||fe(".data"),console.log("Validating your client ID, hold on..."),await Ge(n)?(console.log("Client ID has been validated successfully."),tt(".data/soundcloud.data",JSON.stringify({client_id:n},void 0,4))):console.log("That doesn't look like a valid client ID. Retry with a correct client ID."),t.close()})}else if(r.toLowerCase().startsWith("yo")){if(!i){console.log("You already had cookie, just paste that in setToken function."),t.close();return}t.question("Cookies : ",s=>{if(!s||s.length===0){console.log("You didn't provide a cookie. Try again..."),t.close();return}me(".data")||fe(".data"),console.log("Cookies has been added successfully.");let n={};s.split(";").forEach(o=>{let l=o.split("=");if(l.length<=1)return;let d=l.shift()?.trim(),c=l.join("=").trim();Object.assign(n,{[d]:c})}),tt(".data/youtube.data",JSON.stringify({cookie:n},void 0,4)),t.close()})}else console.log("That option doesn't exist. Try again..."),t.close()})})}a(ri,"authorization");function si(t,e){let i=t.listeners("idle");for(let o of i)o.__playDlAttachedListener&&(o(),t.removeListener("idle",o));let r=a(()=>e.pause(),"pauseListener"),s=a(()=>e.resume(),"resumeListener"),n=a(()=>{t.removeListener("paused",r),t.removeListener("autopaused",r),t.removeListener("playing",s)},"idleListener");r.__playDlAttachedListener=!0,s.__playDlAttachedListener=!0,n.__playDlAttachedListener=!0,t.on("paused",r),t.on("autopaused",r),t.on("playing",s),t.once("idle",n)}a(si,"attachListeners");var ds={DeezerAlbum:U,DeezerPlaylist:W,DeezerTrack:y,SoundCloudPlaylist:z,SoundCloudStream:Y,SoundCloudTrack:w,SpotifyAlbum:q,SpotifyPlaylist:M,SpotifyTrack:T,YouTubeChannel:v,YouTubePlayList:x,YouTubeVideo:S,attachListeners:si,authorization:ri,decipher_info:V,deezer:Ze,dz_advanced_track_search:Xe,dz_validate:pe,extractID:B,getFreeClientID:Ve,is_expired:Ye,playlist_info:ne,refreshToken:le,search:ei,setToken:et,so_validate:ce,soundcloud:ue,spotify:Me,sp_validate:ae,stream:Xt,stream_from_info:ti,validate:ii,video_basic_info:H,video_info:C,yt_validate:P};export{U as DeezerAlbum,W as DeezerPlaylist,y as DeezerTrack,z as SoundCloudPlaylist,Y as SoundCloudStream,w as SoundCloudTrack,q as SpotifyAlbum,M as SpotifyPlaylist,T as SpotifyTrack,v as YouTubeChannel,x as YouTubePlayList,S as YouTubeVideo,si as attachListeners,ri as authorization,V as decipher_info,Ze as deezer,ds as default,Xe as dz_advanced_track_search,pe as dz_validate,B as extractID,Ve as getFreeClientID,Ye as is_expired,ne as playlist_info,le as refreshToken,ei as search,et as setToken,ce as so_validate,ue as soundcloud,ae as sp_validate,Me as spotify,Xt as stream,ti as stream_from_info,ii as validate,H as video_basic_info,C as video_info,P as yt_validate};
//# sourceMappingURL=index.mjs.map